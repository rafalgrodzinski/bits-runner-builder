@extern putchar fun: character u64 -> u32

numInternal u32 <- 7
@export numExternal u32 <- 9

printNum fun: number u64
    biggest u64 <- 10
    rep biggest <= number: biggest <- biggest * 10
    biggest <- biggest / 10

    rep biggest > 0, biggest <- biggest / 10
        digit u64 <- number / biggest
        putchar(digit + '0')
        number <- number % biggest
    ;
;

printHex fun: number u64
    biggest u64 <- 16
    digitsCount u64 <- 1
    rep biggest <= number
        biggest <- biggest * 16
        digitsCount <- digitsCount + 1
    ;
    biggest <- biggest / 16

    // prefix
    putchar('0')
    putchar('x')
    if digitsCount % 2 = 1: putchar('0')

    rep biggest > 0, biggest <- biggest / 16
        digit u64 <- number / biggest
        if digit > 9: putchar(digit + 'a' - 10) else: putchar(digit + '0')
        number <- number % biggest
    ;
;

@export main fun
    num1 u64 <- 0xabcd
    num2 u64 <- ~(num1 >> 4 & 0xf)
    printHex(num2 & 0xff)
    putchar('\n')
;